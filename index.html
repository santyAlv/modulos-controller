<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Precios - MÃ³dulos de TelÃ©fonos</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>ðŸ“± Control de Precios de MÃ³dulos Javicell</h1>
            <p class="subtitle">Gestiona los precios de tus mÃ³dulos de telÃ©fonos de forma fÃ¡cil</p>
        </header>

        <div class="actions-bar">
            <button class="btn btn-secondary btn-sm" onclick="downloadDatabase()" title="Descargar base de datos">
                ðŸ’¾ Descargar DB
            </button>
            <button class="btn btn-secondary btn-sm" onclick="document.getElementById('dbFileInput').click()"
                title="Cargar base de datos SQLite o archivo Excel (.xlsx, .xls)">
                ðŸ“‚ Cargar DB/Excel
            </button>
            <input type="file" id="dbFileInput" accept=".db,.sqlite,.sqlite3,.xlsx,.xls" style="display:none"
                onchange="loadDatabaseFile(event)">
            <button class="btn btn-primary btn-sm" onclick="openModal()">
                âž• Agregar MÃ³dulo
            </button>
        </div>

        <div class="search-bar">
            <div class="search-flex-container">
                <div class="search-input-wrapper">
                    <input type="text" id="searchInput" placeholder="ðŸ” Buscar por modelo, marca o precio..."
                        class="search-input">
                </div>
                <button id="cameraBtn" class="camera-btn-premium"
                    onclick="document.getElementById('cameraInput').click()" title="Buscar por foto (CÃ¡mara/GalerÃ­a)"
                    disabled>
                    <span class="camera-icon">ðŸ“¸</span>
                    <span class="camera-text">Escanear Celular</span>
                </button>
            </div>
            <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;"
                onchange="handleCameraCapture(event)">
            <div id="iaResult" class="ia-result-card">
                <div class="ia-result-header">
                    <span class="ia-badge">IA</span>
                    <span>Modelo detectado:</span>
                </div>
                <strong id="iaModelName"></strong>
            </div>
        </div>

        <div id="loadingIndicator" class="loading-indicator" style="display: none;">
            <div class="loading-spinner"></div>
            <p>ðŸ¤– Analizando imagen con IA...</p>
        </div>

        <div id="modulesContainer" class="modules-grid">
            <!-- Los mÃ³dulos se mostrarÃ¡n aquÃ­ dinÃ¡micamente -->
        </div>

        <div id="emptyState" class="empty-state">
            <p>ðŸ“¦ No hay mÃ³dulos registrados</p>
            <p class="empty-state-subtitle">Haz clic en "Agregar MÃ³dulo" para comenzar</p>
        </div>
    </div>

    <!-- Modal para ver detalles del mÃ³dulo -->
    <div id="detailModal" class="modal">
        <div class="modal-content modal-detail">
            <span class="close" onclick="closeDetailModal()">&times;</span>
            <div id="detailContent"></div>
        </div>
    </div>

    <!-- Modal para agregar/editar mÃ³dulo -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Agregar Nuevo MÃ³dulo</h2>
            <form id="moduleForm" onsubmit="saveModule(event)">
                <div class="form-group">
                    <label for="model">Modelo del TelÃ©fono *</label>
                    <input type="text" id="model" required placeholder="Ej: iPhone 14, Samsung S23...">
                </div>

                <div class="form-group">
                    <label for="brand">Marca *</label>
                    <input type="text" id="brand" required placeholder="Ej: Apple, Samsung, Xiaomi...">
                </div>

                <div class="form-group">
                    <label for="imageFile">Imagen del MÃ³dulo</label>
                    <input type="file" id="imageFile" accept="image/*" onchange="handleImageSelect(event)">
                    <small>Selecciona una imagen desde tu computadora</small>
                    <div id="imagePreview" class="image-preview"></div>
                </div>

                <div class="form-group">
                    <label for="price">Precio (USD) *</label>
                    <input type="number" id="price" required min="0" step="0.01" placeholder="0.00">
                </div>

                <div class="form-group">
                    <label for="description">DescripciÃ³n</label>
                    <textarea id="description" rows="3"
                        placeholder="InformaciÃ³n adicional sobre el mÃ³dulo..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js?v=3"></script>
    <script src="db.js"></script>
    <script type="module" src="ai_service.js?v=6"></script>
    <script src="script.js"></script>
    <script src="import_script.js"></script>
</body>

</html>